## クイズ質問とスコアロジック刷新メモ（2026-02-28）

- **対象機能**: 日次クイズ（`/app/quiz`）での Valence（快・不快）・Arousal（活性度）推定、およびそれに基づく性格診断機能

---

## 1. 目的

- これまで Valence / Arousal は **各2問のみ** から算出していたため、ノイズに弱く根拠を説明しづらかった。
- 活動系の質問（`activity-1`〜`activity-5`）は、**タグとしては使っているがスコアには直接反映されていなかった**。
- そこで、
  - **Valence / Arousal の質問を拡充**し、
  - **行動指標（睡眠の質・社交・新しいことへの挑戦）も Arousal に組み込む**
  ことで、「その日の感情・活性度」と性格診断の両方の根拠を強化した。

---

## 2. 設問構成の変更概要

### 2.1 Valence（快・不快）質問（3問）

カテゴリ `\"valence\"` の設問:

1. `valence-1`（スライダー）
   - 質問: 「今日一日を通しての気分はどちらに近いですか？」
   - ラベル:
     - 左: 「とても嫌な一日だった」
     - 右: 「とても良い一日だった」
   - スケール: -100 〜 +100 → 正規化して -1.0 〜 +1.0

2. `valence-2`（5件法ラジオ）
   - 質問: 「今日、『うれしい・楽しい・満足』と感じる瞬間はどのくらいありましたか？」
   - 選択肢:
     - 1: まったくなかった
     - 2: ほとんどなかった
     - 3: ときどきあった
     - 4: よくあった
     - 5: たくさんあった
   - スケール: 1〜5 → (value - 3) / 2 で -1.0 〜 +1.0

3. `valence-3`（5件法ラジオ）
   - 質問: 「今日、『不安・イライラ・落ち込み』をどのくらい強く感じましたか？」
   - 選択肢:
     - 1: とても強く感じた
     - 2: かなり感じた
     - 3: ふつう
     - 4: あまり感じなかった
     - 5: ほとんど感じなかった
   - スケール: 1〜5 → (value - 3) / 2 で -1.0 〜 +1.0  
     → ネガティブ感情が弱いほどプラスになる。

### 2.2 Arousal（活性度）質問（主観3問 + 行動成分）

カテゴリ `\"arousal\"` の設問:

1. `arousal-1`（スライダー）
   - 質問: 「今日はどちらかというと、落ち着いていましたか？それともそわそわ・高ぶっていましたか？」
   - ラベル:
     - 左: 「とても落ち着いていた」
     - 右: 「とてもそわそわ・高ぶっていた」
   - スケール: -100 〜 +100 → -1.0 〜 +1.0

2. `arousal-2`（5件法ラジオ）
   - 質問: 「今日はどのくらい活動的でしたか？」
   - 選択肢:
     - 1: まったく
     - 2: 少し
     - 3: ふつう
     - 4: かなり
     - 5: とても
   - スケール: 1〜5 → (value - 3) / 2 で -1.0 〜 +1.0

3. `arousal-3`（スライダー）
   - 質問: 「今の体と心の元気さはどのくらいですか？」
   - ラベル:
     - 左: 「まったく力が出ない」
     - 右: 「とてもエネルギッシュ」
   - スケール: -100 〜 +100 → -1.0 〜 +1.0

### 2.3 Activity 質問（タグ用途は維持）

- `activity-1`〜`activity-5` の **ID と value は既存どおり** で変更していない。
- これにより、`DailyEntry.activities` を使う性格診断ロジック（`extractActivityPatterns`）との互換性を維持。
- 追加で、以下の3つを **Arousal 算出にも利用**する:
  - `activity-3`（睡眠の質: value が \"1\"〜\"5\"）
  - `activity-4`（人との交流: \"たくさん\" / \"少し\" / \"ほとんどなし\" / \"まったくなし\"）
  - `activity-5`（新しいことに挑戦: \"はい\" / \"いいえ\"）

---

## 3. Valence / Arousal の計算ロジック

実装: `app/lib/quiz-questions.ts` の `calculateValenceArousal`

### 3.1 Valence 計算

- スライダー:
  - `valence-1` → `sliderValence = raw / 100` （-1.0〜+1.0）
- 5件法:
  - `valence-2` → `valence2 = (value - 3) / 2`
  - `valence-3` → `valence3 = (value - 3) / 2`
- 有効な成分のみ平均:
  - `valenceComponents = [sliderValence, valence2?, valence3?]`
  - `valence = mean(valenceComponents)` を小数第2位で丸めて保存。

### 3.2 Arousal 計算（主観 + 行動）

**主観的成分**

- `arousal-1` → `sliderArousal1 = raw / 100`
- `arousal-2` → `arousal2 = (value - 3) / 2`
- `arousal-3` → `sliderArousal3 = raw / 100`

**行動成分**

- 睡眠の質（`activity-3`）
  - value: \"1\"〜\"5\" を数値化 → `sleepRaw`
  - `sleepComponent = (sleepRaw - 3) / 2`（質が高いほど +）
- 人との交流（`activity-4`）
  - value を以下でマップ:
    - \"まったくなし\" → -1
    - \"ほとんどなし\" → -0.5
    - \"少し\" → 0
    - \"たくさん\" → +1
  - → `socialComponent`
- 新しいことへの挑戦（`activity-5`）
  - \"はい\" の場合のみ `noveltyComponent = 0.5`、それ以外は寄与なし。

**Arousal 最終値**

- 全成分を配列にまとめて単純平均:
  - `arousalComponents = [sliderArousal1, sliderArousal3, arousal2?, sleepComponent?, socialComponent?, noveltyComponent?]`
  - `arousal = mean(arousalComponents)` を小数第2位で丸めて保存。

---

## 4. 性格診断への影響と互換性

- 性格診断ロジック（`app/lib/personality-assessment.ts`）は以下のみを使用:
  - `DailyEntry.valence` / `DailyEntry.arousal`
  - `DailyEntry.activities`
- 今回の変更で:
  - `valence` / `arousal` は **同じフィールド名・同じレンジ（-1.0〜+1.0）を維持しつつ、構成質問が増えて精度が向上**。
  - `activities` に入るタグ（\"運動\"、\"たくさん\"、\"はい\"、\"1\"〜\"5\" など）の仕様は変更していない。
- そのため:
  - `computeADP`（平均・SD・MSSD・自己相関）や `extractActivityPatterns`（社交頻度・新規活動率・睡眠の質・運動頻度・活動多様性）の計算はそのまま動作する。
  - `assessPersonality` が推定する Big Five スコアは、**より情報量の多い日次 Valence/Arousal に基づくようになり、理論的には安定性が向上**する。

---

## 5. アプリ内で説明できるポイント（対ユーザー向け）

- 「このアプリでは、感情心理学で広く使われている **Valence（快−不快）** と **Arousal（活性度）** の2軸モデル（ラッセルの感情円環モデル）を採用しています。」
- 「快・不快は、一日全体の満足度に加えて、『うれしい・楽しい・満足』の頻度と『不安・イライラ・落ち込み』の強さを組み合わせてスコア化しています。」
- 「活性度は、主観的なエネルギー感や落ち着き度に加えて、**睡眠の質・人との交流・新しいことへの挑戦**といった行動指標も組み合わせて推定しています。」
- 「これらの日次スコアのパターン（平均・変動性・安定性）と活動パターンをもとに、心理学研究に基づいた Big Five 性格特性の推定を行っていますが、臨床診断ではなく自己理解の参考情報として提供しています。」

