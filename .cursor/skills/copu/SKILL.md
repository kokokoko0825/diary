---
name: copu
description: Git の変更をコミットしてリモートリポジトリにプッシュする標準ワークフローを実行する。ユーザーが git commit や git push を依頼したとき、または変更をリポジトリに反映したいときに使用する。
---

# copu

## 意図

- このスキルは、**安全かつ一貫した手順で git commit / git push を行うためのワークフロー**を定義する。
- 既にリポジトリ設定やブランチ戦略が存在する前提で、エージェントが勝手に危険な操作（強制 push / 履歴改変など）をしないように制約を与える。

## 使用するタイミング

- ユーザーが「commit して」「push して」「コミット & プッシュして」などと依頼したとき。
- 変更をまとめて保存したい、作業単位を区切りたいとき。
- Pull Request 作成前にコミットを整理して push したいとき。

## 禁止事項

- `git push --force` / `git push -f` など履歴を書き換える操作は禁止。
- `git commit --amend` は、**直前のコミットをこのエージェント自身が作成した**かつ**まだ push していない**場合のみ検討し、基本的には新しいコミットを作る。
- `git config` の変更は禁止。
- パスワードや API キーなどのシークレットを含むファイル（`.env` など）は、ユーザーが明示的に指示しない限り add / commit しない。

## 手順

1. **状態確認**
   - `git status` を実行し、変更ファイル・未追跡ファイル・現在のブランチを確認する。
   - `git diff` / `git diff --cached` で差分を把握し、何をコミットするか整理する。

2. **コミット内容の決定**
   - コミット対象ファイルを論理的なまとまりごとに判断する。
   - 不要なファイル（ビルド成果物、一時ファイル、明らかなゴミ）はステージングしない。

3. **コミットメッセージ案の作成**
   - 差分を読み、**なぜこの変更が必要か**を 1 行目に要約したコミットメッセージを作る。
   - 2 行目を空行にし、3 行目以降に補足（主な変更点、影響範囲、注意点など）を必要に応じて記載する形式を推奨する。
   - プロジェクトに既存のコミットメッセージ規約（Conventional Commits など）があれば、それに合わせる。

4. **テスト / チェック（可能であれば）**
   - プロジェクトに用意されているコマンドがあれば、コミット前または後に実行する。
     - 例: `pnpm lint`, `pnpm typecheck`, `pnpm test` など。
   - 失敗した場合は、その内容を確認し、可能な範囲で修正した上で再度実行する。

5. **ステージング**
   - 決めたファイルのみ `git add` する。
   - `git diff --cached` でステージ済みの差分を最終確認する。

6. **コミット作成**
   - 作成したコミットメッセージを用いて `git commit` を実行する。
   - フックにより自動修正が発生した場合は、**amend ではなく新しいコミット**を作る方針とする（例外は「禁止事項」を参照）。

7. **リモート状態の確認**
   - `git status -sb` や `git rev-parse --abbrev-ref --symbolic-full-name @{u}` を用いて、現在のブランチがリモートを追跡しているか確認する。
   - リモートブランチが存在しない場合は、`git push -u origin <current-branch>` を使用する。

8. **push 実行**
   - `git push` を実行し、エラーがないことを確認する。
   - リジェクトされた場合（例: リモートに新しいコミットがある）は、`git pull --rebase` などの安全な方法で追従し、競合を解消した上で再度 `git push` する。
   - それでも解決が難しい場合は、ユーザーに状況を説明し、方針（リベース / マージ / force push 可否など）を確認してから続行する。

9. **完了報告**
   - どのファイルがどのコミットに含まれたか、どのブランチに push されたかを簡潔にまとめてユーザーに報告する。

## 例

### 例 1: 単純な修正をコミット & プッシュ

1. `git status` で `app/component/Header.tsx` のみ変更されていることを確認。
2. 差分を確認し、バグ修正であることを把握。
3. コミットメッセージ案:
   - `fix(header): タイトル表示の崩れを修正`
4. `git add app/component/Header.tsx`
5. `git commit -m "fix(header): タイトル表示の崩れを修正"`
6. `git push`

### 例 2: 新機能の追加

1. 複数ファイルにわたる差分を論理的に 1 つの機能と見なせることを確認。
2. コミットメッセージ案:
   - `feat(diary): 日記の検索フィルターを追加`
3. 必要なファイルのみ `git add` し、`git diff --cached` で確認。
4. `git commit` → `git push` の順で実施。

